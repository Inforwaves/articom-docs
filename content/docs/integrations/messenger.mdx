---
title: Facebook Messenger Integration
description: Connect your AI agents with Facebook Messenger
---

## Overview

Integrate Articom with Facebook Messenger to automate conversations and provide instant support to your Facebook page visitors.

The Messenger integration enables you to:
- Respond to messages on your Facebook Page
- Automate customer conversations
- Use rich messaging features (buttons, quick replies, cards)
- Handle multiple conversations simultaneously
- Track message analytics

## Prerequisites

- Facebook Page with admin access
- Facebook Developer account
- Meta Business Manager account

## Setup

### Step 1: Create Facebook App

1. Go to [Facebook Developers](https://developers.facebook.com)
2. Create a new app or use existing one
3. Add Messenger product to your app
4. Get Page Access Token

### Step 2: Connect to Articom

```javascript
const messenger = await articom.integrations.connect({
  type: "messenger",
  config: {
    pageId: "YOUR_PAGE_ID",
    pageAccessToken: "YOUR_PAGE_ACCESS_TOKEN",
    appSecret: "YOUR_APP_SECRET",
    verifyToken: "YOUR_VERIFY_TOKEN"
  }
});
```

### Step 3: Setup Webhook

```javascript
const webhook = await messenger.setupWebhook({
  url: "https://your-domain.com/webhooks/messenger",
  fields: [
    "messages",
    "messaging_postbacks",
    "messaging_optins",
    "message_deliveries",
    "message_reads"
  ]
});
```

## Sending Messages

### Text Messages

```javascript
await messenger.sendMessage({
  recipient: { id: "USER_PSID" },
  message: {
    text: "Hello! How can I help you today?"
  }
});
```

### Quick Replies

```javascript
await messenger.sendMessage({
  recipient: { id: "USER_PSID" },
  message: {
    text: "What would you like to do?",
    quick_replies: [
      {
        content_type: "text",
        title: "Check Order",
        payload: "CHECK_ORDER"
      },
      {
        content_type: "text",
        title: "Contact Support",
        payload: "CONTACT_SUPPORT"
      },
      {
        content_type: "text",
        title: "View Products",
        payload: "VIEW_PRODUCTS"
      }
    ]
  }
});
```

### Button Template

```javascript
await messenger.sendMessage({
  recipient: { id: "USER_PSID" },
  message: {
    attachment: {
      type: "template",
      payload: {
        template_type: "button",
        text: "What would you like to do?",
        buttons: [
          {
            type: "web_url",
            url: "https://example.com/products",
            title: "View Products"
          },
          {
            type: "postback",
            title: "Contact Support",
            payload: "CONTACT_SUPPORT"
          }
        ]
      }
    }
  }
});
```

### Generic Template (Cards)

```javascript
await messenger.sendMessage({
  recipient: { id: "USER_PSID" },
  message: {
    attachment: {
      type: "template",
      payload: {
        template_type: "generic",
        elements: [
          {
            title: "Product 1",
            image_url: "https://example.com/product1.jpg",
            subtitle: "$29.99",
            default_action: {
              type: "web_url",
              url: "https://example.com/product1"
            },
            buttons: [
              {
                type: "postback",
                title: "Buy Now",
                payload: "BUY_PRODUCT_1"
              }
            ]
          },
          {
            title: "Product 2",
            image_url: "https://example.com/product2.jpg",
            subtitle: "$39.99",
            buttons: [
              {
                type: "postback",
                title: "Buy Now",
                payload: "BUY_PRODUCT_2"
              }
            ]
          }
        ]
      }
    }
  }
});
```

## Receiving Messages

### Handle Incoming Messages

```javascript
messenger.onMessage(async (event) => {
  const senderId = event.sender.id;
  const messageText = event.message.text;

  console.log(`Received message from ${senderId}: ${messageText}`);

  // Process with AI agent
  const response = await agent.processMessage({
    text: messageText,
    userId: senderId,
    channel: "messenger"
  });

  // Send response
  await messenger.sendMessage({
    recipient: { id: senderId },
    message: { text: response.text }
  });
});
```

### Handle Postbacks

```javascript
messenger.onPostback(async (event) => {
  const senderId = event.sender.id;
  const payload = event.postback.payload;

  switch (payload) {
    case "GET_STARTED":
      await sendWelcomeMessage(senderId);
      break;
    case "CONTACT_SUPPORT":
      await escalateToHuman(senderId);
      break;
    case "CHECK_ORDER":
      await showOrderStatus(senderId);
      break;
  }
});
```

### Handle Quick Reply

```javascript
messenger.onQuickReply(async (event) => {
  const payload = event.message.quick_reply.payload;
  const senderId = event.sender.id;

  await handleQuickReply(senderId, payload);
});
```

## Advanced Features

### Get Started Button

```javascript
await messenger.setGetStartedButton({
  payload: "GET_STARTED"
});
```

### Persistent Menu

```javascript
await messenger.setPersistentMenu({
  persistent_menu: [
    {
      locale: "default",
      composer_input_disabled: false,
      call_to_actions: [
        {
          type: "postback",
          title: "View Products",
          payload: "VIEW_PRODUCTS"
        },
        {
          type: "postback",
          title: "Track Order",
          payload: "TRACK_ORDER"
        },
        {
          type: "web_url",
          title: "Visit Website",
          url: "https://example.com"
        }
      ]
    }
  ]
});
```

### Greeting Text

```javascript
await messenger.setGreeting({
  greeting: [
    {
      locale: "default",
      text: "Hi {{user_first_name}}! Welcome to our page. How can we help you today?"
    },
    {
      locale: "es_ES",
      text: "¡Hola {{user_first_name}}! Bienvenido a nuestra página."
    }
  ]
});
```

### Typing Indicators

```javascript
// Show typing
await messenger.sendAction({
  recipient: { id: "USER_PSID" },
  sender_action: "typing_on"
});

// Process request...

// Stop typing
await messenger.sendAction({
  recipient: { id: "USER_PSID" },
  sender_action: "typing_off"
});
```

### Read Receipts

```javascript
await messenger.sendAction({
  recipient: { id: "USER_PSID" },
  sender_action: "mark_seen"
});
```

## Media Messages

### Images

```javascript
await messenger.sendMessage({
  recipient: { id: "USER_PSID" },
  message: {
    attachment: {
      type: "image",
      payload: {
        url: "https://example.com/image.jpg",
        is_reusable: true
      }
    }
  }
});
```

### Videos

```javascript
await messenger.sendMessage({
  recipient: { id: "USER_PSID" },
  message: {
    attachment: {
      type: "video",
      payload: {
        url: "https://example.com/video.mp4"
      }
    }
  }
});
```

### Files

```javascript
await messenger.sendMessage({
  recipient: { id: "USER_PSID" },
  message: {
    attachment: {
      type: "file",
      payload: {
        url: "https://example.com/document.pdf"
      }
    }
  }
});
```

## User Information

### Get User Profile

```javascript
const userProfile = await messenger.getUserProfile({
  userId: "USER_PSID",
  fields: ["first_name", "last_name", "profile_pic", "locale", "timezone"]
});

console.log({
  name: `${userProfile.first_name} ${userProfile.last_name}`,
  picture: userProfile.profile_pic,
  locale: userProfile.locale,
  timezone: userProfile.timezone
});
```

## Agent Integration

### Connect Agent

```javascript
const agent = await articom.agents.get("agent_123");

await agent.addChannel({
  type: "messenger",
  config: {
    pageId: "YOUR_PAGE_ID",
    autoRespond: true,
    responseDelay: 1000, // ms
    features: {
      typingIndicator: true,
      readReceipts: true,
      persistentMenu: true
    }
  }
});
```

### Auto-responses

```javascript
agent.setMessengerConfig({
  greeting: "Hi {{user_first_name}}! How can I assist you today?",
  awayMessage: {
    enabled: true,
    message: "We're currently away but will respond soon!",
    schedule: {
      enabled: true,
      businessHours: "9am-5pm EST"
    }
  }
});
```

## Analytics

```javascript
const analytics = await messenger.getAnalytics({
  period: "last_30_days"
});

console.log({
  totalMessages: analytics.messagesReceived,
  uniqueUsers: analytics.uniqueUsers,
  responseTime: analytics.avgResponseTime,
  satisfaction: analytics.satisfactionScore
});
```

## Best Practices

### 1. Response Time
Respond quickly (< 5 seconds) to maintain user engagement.

### 2. Use Rich Features
Leverage buttons, quick replies, and cards for better UX.

### 3. Personalization
Use user's first name and tailor responses based on history.

### 4. Human Handoff
Have a clear escalation path to human agents.

### 5. Compliance
Follow Facebook's Platform Policies and Messenger Guidelines.

## Rate Limits

- **Messaging**: No hard limits, but avoid spam
- **Profile API**: Rate limited per user
- **Broadcast**: Requires Message Tags for promotional content

## Message Tags

For messages outside 24-hour window:

```javascript
await messenger.sendMessage({
  recipient: { id: "USER_PSID" },
  message: { text: "Your order has shipped!" },
  messaging_type: "MESSAGE_TAG",
  tag: "SHIPPING_UPDATE"
});
```

Available tags:
- `CONFIRMED_EVENT_UPDATE`
- `POST_PURCHASE_UPDATE`
- `ACCOUNT_UPDATE`

## Troubleshooting

### Message Not Sent
- Verify Page Access Token is valid
- Check user hasn't blocked the page
- Ensure within 24-hour messaging window or using valid tag

### Webhook Not Receiving
- Verify webhook URL is accessible
- Check verify token matches
- Ensure app is subscribed to page

## Next Steps

<Cards>
  <Card title="View All Channels" href="/integrations/overview" />
  <Card title="WhatsApp" href="/integrations/whatsapp" />
  <Card title="Instagram" href="/integrations/instagram" />
  <Card title="Slack" href="/integrations/slack" />
</Cards>
